#! /bin/bash
#

export PATH="/opt/puppet/bin:$PATH"
timestamp="$(ruby -e 'puts Time.now.to_i')"
module="cve20113872"

manifest="$(puppet master --configprint manifest)"

if grep -q "include ${module}" "${manifest}"; then
  echo "site.pp already includes class ${module} ... (Nothing to do)"
else
  echo "Adding ${module} to the top scope of site.pp ..."
  echo "" >> "${manifest}"
  echo "# This class should be removed after the CVE-2011-3872 migration" >> "${manifest}"
  echo "# process is complete finished" >> "${manifest}"
  echo "include cve20113872" >> "${manifest}"
fi

echo "Done ..."
